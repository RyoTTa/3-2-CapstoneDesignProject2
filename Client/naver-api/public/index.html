<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <title>간단한 지도 표시하기</title>
    <!--<script src="../src/capture.js"></script>-->
  </head>
  <body>
    <div id="root"></div>
    <div id="map" style="width: 100%; height: 100vh;"></div>

    <script
      type="text/javascript"
      src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=pg43l9dp5c"
    ></script>

    <script>
      var capture_log;

      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function () {
        // 요청에 대한 콜백
        if (xhr.readyState === xhr.DONE) {
          // 요청이 완료되면
          if (xhr.status === 200 || xhr.status === 201) {
            capture_log = JSON.parse(xhr.responseText);
            console.log(capture_log.length);
            var newWindow = window.open("", "View Data");
            newWindow.document.close();
            newWindow.document.write(
              '<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">'
            );
            newWindow.document.write(
              "<scr" +
                'ipt src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"><' +
                "/script>"
            );

            newWindow.document.write(
              '<form action = "get_payment_date.jsp" method="post">'
            );

            newWindow.document.write("<p/><p/>");

            newWindow.document.write(
              '<label for="fromDate" style="margin-left: 20px; margin-right:5px">날짜 </label>'
            );
            newWindow.document.write(
              '<input type="date" name="fromDate" id="fromDate" value="" onkeypress="dateFunction()" style="text-align:center;">'
            );
            newWindow.document.write(
              '~ <input type="date" name="toDate" id="toDate" value="" onkeypress="dateFunction()" style="text-align:center;">'
            );

            newWindow.document.write(
              '<button type = "submit" class="button_ViewList" style="margin-left: 20px;")>조회</button>'
            );

            newWindow.document.write("</form>");

            newWindow.document.write('<table class="table table-striped">');
            newWindow.document.write('<thead class="thead-dark">');
            newWindow.document.write("<tr>");
            newWindow.document.write("<th> 번호 </th>");
            newWindow.document.write("<th> 카메라 </th>");
            newWindow.document.write("<th> 시간 </th>");
            newWindow.document.write("<th> 탐지한 수 </th>");
            newWindow.document.write("<th> img </th>");
            newWindow.document.write("</tr>");
            newWindow.document.write("</thead>");
            newWindow.document.write("<tbody>");

            for (var i = capture_log.length - 1; i >= 0; i--) {
              newWindow.document.write("<tr>");
              newWindow.document.write("<td>" + (i + 1) + "</td>");
              newWindow.document.write("<td>" + capture_log[i].id + "</td>");
              newWindow.document.write("<td>" + capture_log[i].time + "</td>");
              newWindow.document.write("<td>" + capture_log[i].count + "</td>");
              //document.write('<td> <a href="http://155.230.28.207:3000/request_img?img_name='+capture_log[i].img_name+'">확인</a> </td>');
              newWindow.document.write(
                '<td> <a target=_blank href="http://155.230.28.207:3000/request_img?img_name=' +
                  capture_log[i].img_name +
                  '" onclick="window.open(this.href,"_blank","width=400,,height=400");return false">확인</a> </td>'
              );
              newWindow.document.write("</tr>");
            }
            newWindow.document.write("</tbody>");
            newWindow.document.write("</table>");
            newWindow.document.title = "View Data";
            newWindow.document.close();
          } else {
            console.log(xhr.responseText);
          }
        }
      };

      var bound = new naver.maps.LatLngBounds(
        new naver.maps.LatLng(35.721397, 128.300916),
        new naver.maps.LatLng(35.973666, 128.764745)
      );

      // 맵 생성
      var map = new naver.maps.Map("map", {
        minZoom: 11, // 읍면동 레벨
        center: new naver.maps.LatLng(35.889845, 128.6105),
        zoom: 17,
        maxBounds: bound,
        //mapTypeId: "normal",
      });

      // 마커 생성
      var marker1 = new naver.maps.Marker({
        position: new naver.maps.LatLng(35.88689, 128.608494),
        map: map,
        animation: naver.maps.Animation.BOUNCE,
      });

      var marker2 = new naver.maps.Marker({
        position: new naver.maps.LatLng(35.888154, 128.6109),
        map: map,
        animation: naver.maps.Animation.BOUNCE,
      });

      var marker3 = new naver.maps.Marker({
        position: new naver.maps.LatLng(35.88814, 128.611388),
        map: map,
        animation: naver.maps.Animation.BOUNCE,
      });

      // 마커 이벤트
      naver.maps.Event.addListener(marker1, "click", function () {
        xhr.open(
          "GET",
          "http://155.230.28.207:3000/capture_log?cam_id=" + "001",
          true
        );
        xhr.send();
      });

      naver.maps.Event.addListener(marker2, "click", function () {
        xhr.open(
          "GET",
          "http://155.230.28.207:3000/capture_log?cam_id=" + "002",
          true
        );
        xhr.send();
      });

      naver.maps.Event.addListener(marker3, "click", function () {
        xhr.open(
          "GET",
          "http://155.230.28.207:3000/capture_log?cam_id=" + "003",
          true
        );
        xhr.send();
      });

      // 대구 테두리

      var Daegu = new naver.maps.Polygon({
        map: map,
        paths: [
          [
            new naver.maps.LatLng(36.0155733, 128.6960412),
            new naver.maps.LatLng(36.0032279, 128.7268779),
            new naver.maps.LatLng(35.9853614, 128.7309739),
            new naver.maps.LatLng(35.9728686, 128.7462102),
            new naver.maps.LatLng(35.9295961, 128.7366945),
            new naver.maps.LatLng(35.9067465, 128.7599251),
            new naver.maps.LatLng(35.866058, 128.7597675),
            new naver.maps.LatLng(35.8512982, 128.7385723),
            new naver.maps.LatLng(35.85686, 128.7218141),
            new naver.maps.LatLng(35.8359809, 128.7250118),
            new naver.maps.LatLng(35.8263781, 128.7085255),
            new naver.maps.LatLng(35.8070139, 128.7174619),
            new naver.maps.LatLng(35.7901504, 128.6823415),
            new naver.maps.LatLng(35.7564327, 128.6960775),
            new naver.maps.LatLng(35.7216617, 128.683266),
            new naver.maps.LatLng(35.7031625, 128.6201766),
            new naver.maps.LatLng(35.7439735, 128.6090612),
            new naver.maps.LatLng(35.7310761, 128.5888805),
            new naver.maps.LatLng(35.7379457, 128.5816771),
            new naver.maps.LatLng(35.7362167, 128.5642024),
            new naver.maps.LatLng(35.7114429, 128.5286892),
            new naver.maps.LatLng(35.6937883, 128.5356596),
            new naver.maps.LatLng(35.6832618, 128.5298805),
            new naver.maps.LatLng(35.6729581, 128.507685),
            new naver.maps.LatLng(35.6391973, 128.5053628),
            new naver.maps.LatLng(35.6384241, 128.4465993),
            new naver.maps.LatLng(35.6216381, 128.43101),
            new naver.maps.LatLng(35.6250996, 128.4227538),
            new naver.maps.LatLng(35.6065398, 128.3823989),
            new naver.maps.LatLng(35.6108809, 128.3717476),
            new naver.maps.LatLng(35.6232489, 128.3933059),
            new naver.maps.LatLng(35.6440742, 128.398697),
            new naver.maps.LatLng(35.6768813, 128.3596807),
            new naver.maps.LatLng(35.7040156, 128.3517967),
            new naver.maps.LatLng(35.7087012, 128.3588782),
            new naver.maps.LatLng(35.6958418, 128.4122017),
            new naver.maps.LatLng(35.7048945, 128.4321466),
            new naver.maps.LatLng(35.725598, 128.4318159),
            new naver.maps.LatLng(35.7483526, 128.3912469),
            new naver.maps.LatLng(35.7600868, 128.3834692),
            new naver.maps.LatLng(35.8093545, 128.4208295),
            new naver.maps.LatLng(35.8059355, 128.4664271),
            new naver.maps.LatLng(35.8189025, 128.4798359),
            new naver.maps.LatLng(35.8396161, 128.468946),
            new naver.maps.LatLng(35.8466568, 128.4500015),
            new naver.maps.LatLng(35.8528346, 128.3835101),
            new naver.maps.LatLng(35.8999265, 128.3989766),
            new naver.maps.LatLng(35.9013013, 128.4074346),
            new naver.maps.LatLng(35.9280408, 128.4249016),
            new naver.maps.LatLng(35.9350416, 128.4503381),
            new naver.maps.LatLng(35.9431494, 128.4541552),
            new naver.maps.LatLng(35.9344393, 128.4764188),
            new naver.maps.LatLng(35.9003086, 128.467786),
            new naver.maps.LatLng(35.8947957, 128.4751758),
            new naver.maps.LatLng(35.8979803, 128.4905824),
            new naver.maps.LatLng(35.8871588, 128.5022418),
            new naver.maps.LatLng(35.9061093, 128.5068262),
            new naver.maps.LatLng(35.9236223, 128.5294652),
            new naver.maps.LatLng(35.9383554, 128.535366),
            new naver.maps.LatLng(35.980238, 128.5288778),
            new naver.maps.LatLng(35.9607414, 128.5534071),
            new naver.maps.LatLng(35.9722248, 128.5568131),
            new naver.maps.LatLng(35.9859057, 128.6028925),
            new naver.maps.LatLng(36.0067373, 128.6174858),
            new naver.maps.LatLng(36.0155733, 128.6960412),
          ],
        ],
        strokeColor: "black",
        strokeOpacity: 0.6,
        strokeWeight: 3,
      });
    </script>
  </body>
</html>
